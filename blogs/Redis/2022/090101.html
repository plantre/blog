<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Redis | Overfly</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="note">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.eb5f38e4.css" as="style"><link rel="preload" href="/assets/js/app.05e9a5df.js" as="script"><link rel="preload" href="/assets/js/3.c925c384.js" as="script"><link rel="preload" href="/assets/js/1.9975a5e7.js" as="script"><link rel="preload" href="/assets/js/47.ab37bc5f.js" as="script"><link rel="prefetch" href="/assets/js/10.555bb3dd.js"><link rel="prefetch" href="/assets/js/11.c120359e.js"><link rel="prefetch" href="/assets/js/12.ad886030.js"><link rel="prefetch" href="/assets/js/13.d0777667.js"><link rel="prefetch" href="/assets/js/14.6c1a3ffa.js"><link rel="prefetch" href="/assets/js/15.7b9a9692.js"><link rel="prefetch" href="/assets/js/16.6f5dbf91.js"><link rel="prefetch" href="/assets/js/17.9acd08f6.js"><link rel="prefetch" href="/assets/js/18.bda725fe.js"><link rel="prefetch" href="/assets/js/19.ef19e8ce.js"><link rel="prefetch" href="/assets/js/20.93be3e1b.js"><link rel="prefetch" href="/assets/js/21.780a535b.js"><link rel="prefetch" href="/assets/js/22.25628208.js"><link rel="prefetch" href="/assets/js/23.64dc5354.js"><link rel="prefetch" href="/assets/js/24.a95ee7d3.js"><link rel="prefetch" href="/assets/js/25.f5a34804.js"><link rel="prefetch" href="/assets/js/26.c3286c78.js"><link rel="prefetch" href="/assets/js/27.f3c48b46.js"><link rel="prefetch" href="/assets/js/28.bb1619dc.js"><link rel="prefetch" href="/assets/js/29.59e6b149.js"><link rel="prefetch" href="/assets/js/30.c1dac843.js"><link rel="prefetch" href="/assets/js/31.374d1e46.js"><link rel="prefetch" href="/assets/js/32.a1821089.js"><link rel="prefetch" href="/assets/js/33.2aab4f19.js"><link rel="prefetch" href="/assets/js/34.cd7ac131.js"><link rel="prefetch" href="/assets/js/35.bbe62b13.js"><link rel="prefetch" href="/assets/js/36.0a1cd34b.js"><link rel="prefetch" href="/assets/js/37.c12ef26f.js"><link rel="prefetch" href="/assets/js/38.e70e7566.js"><link rel="prefetch" href="/assets/js/39.68ca1f39.js"><link rel="prefetch" href="/assets/js/4.f1a2d0e3.js"><link rel="prefetch" href="/assets/js/40.c3d0f2a1.js"><link rel="prefetch" href="/assets/js/41.7eab50b7.js"><link rel="prefetch" href="/assets/js/42.4719f4f5.js"><link rel="prefetch" href="/assets/js/43.fcea90e4.js"><link rel="prefetch" href="/assets/js/44.f2127464.js"><link rel="prefetch" href="/assets/js/45.2eac0f1c.js"><link rel="prefetch" href="/assets/js/46.97908625.js"><link rel="prefetch" href="/assets/js/48.0c7782e0.js"><link rel="prefetch" href="/assets/js/49.26bcae1d.js"><link rel="prefetch" href="/assets/js/5.a55da33a.js"><link rel="prefetch" href="/assets/js/50.d1ed5dd6.js"><link rel="prefetch" href="/assets/js/51.49872e4a.js"><link rel="prefetch" href="/assets/js/52.24e6994d.js"><link rel="prefetch" href="/assets/js/53.37f611f3.js"><link rel="prefetch" href="/assets/js/54.7ff499b2.js"><link rel="prefetch" href="/assets/js/55.675be805.js"><link rel="prefetch" href="/assets/js/56.7a98c9cc.js"><link rel="prefetch" href="/assets/js/57.ab21d575.js"><link rel="prefetch" href="/assets/js/58.5e4df500.js"><link rel="prefetch" href="/assets/js/59.c7be1d56.js"><link rel="prefetch" href="/assets/js/6.180231f1.js"><link rel="prefetch" href="/assets/js/60.f7786110.js"><link rel="prefetch" href="/assets/js/61.80b89a9d.js"><link rel="prefetch" href="/assets/js/62.3db93655.js"><link rel="prefetch" href="/assets/js/63.da888a6b.js"><link rel="prefetch" href="/assets/js/64.45fa7185.js"><link rel="prefetch" href="/assets/js/7.80061948.js"><link rel="prefetch" href="/assets/js/8.a920b205.js"><link rel="prefetch" href="/assets/js/9.0721afe9.js">
    <link rel="stylesheet" href="/assets/css/0.styles.eb5f38e4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>Overfly</h3> <p class="description" data-v-59e6cb88>note</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>wzg</span>
          
        <span data-v-59e6cb88>2017 - </span>
        2024
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="Overfly" class="logo"> <span class="site-name">Overfly</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Algorithm/" class="nav-link"><i class="undefined"></i>
  Algorithm
</a></li><li class="dropdown-item"><!----> <a href="/categories/Base/" class="nav-link"><i class="undefined"></i>
  Base
</a></li><li class="dropdown-item"><!----> <a href="/categories/CloudNative/" class="nav-link"><i class="undefined"></i>
  CloudNative
</a></li><li class="dropdown-item"><!----> <a href="/categories/DesignPattern/" class="nav-link"><i class="undefined"></i>
  DesignPattern
</a></li><li class="dropdown-item"><!----> <a href="/categories/Devops/" class="nav-link"><i class="undefined"></i>
  Devops
</a></li><li class="dropdown-item"><!----> <a href="/categories/Distributed/" class="nav-link"><i class="undefined"></i>
  Distributed
</a></li><li class="dropdown-item"><!----> <a href="/categories/Dubbo/" class="nav-link"><i class="undefined"></i>
  Dubbo
</a></li><li class="dropdown-item"><!----> <a href="/categories/Es/" class="nav-link"><i class="undefined"></i>
  Es
</a></li><li class="dropdown-item"><!----> <a href="/categories/Front/" class="nav-link"><i class="undefined"></i>
  Front
</a></li><li class="dropdown-item"><!----> <a href="/categories/Java/" class="nav-link"><i class="undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/categories/Linux/" class="nav-link"><i class="undefined"></i>
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/categories/MySQL/" class="nav-link"><i class="undefined"></i>
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/categories/MQ/" class="nav-link"><i class="undefined"></i>
  MQ
</a></li><li class="dropdown-item"><!----> <a href="/categories/Netty/" class="nav-link"><i class="undefined"></i>
  Netty
</a></li><li class="dropdown-item"><!----> <a href="/categories/Others/" class="nav-link"><i class="undefined"></i>
  Others
</a></li><li class="dropdown-item"><!----> <a href="/categories/Redis/" class="nav-link"><i class="undefined"></i>
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/categories/Spring/" class="nav-link"><i class="undefined"></i>
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/categories/Tools/" class="nav-link"><i class="undefined"></i>
  Tools
</a></li><li class="dropdown-item"><!----> <a href="/categories/Zookeeper/" class="nav-link"><i class="undefined"></i>
  Zookeeper
</a></li><li class="dropdown-item"><!----> <a href="/categories/WorkFlow/" class="nav-link"><i class="undefined"></i>
  WorkFlow
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Docs
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/theme-reco/" class="nav-link"><i class="undefined"></i>
  vuepress-reco
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/plantre" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><img src="/avatar.png" alt="author-avatar" class="personal-img" data-v-1fad0c41> <h3 class="name" data-v-1fad0c41>
    wzg
  </h3> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>54</h3> <h6 data-v-1fad0c41>Articles</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>38</h3> <h6 data-v-1fad0c41>Tags</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Algorithm/" class="nav-link"><i class="undefined"></i>
  Algorithm
</a></li><li class="dropdown-item"><!----> <a href="/categories/Base/" class="nav-link"><i class="undefined"></i>
  Base
</a></li><li class="dropdown-item"><!----> <a href="/categories/CloudNative/" class="nav-link"><i class="undefined"></i>
  CloudNative
</a></li><li class="dropdown-item"><!----> <a href="/categories/DesignPattern/" class="nav-link"><i class="undefined"></i>
  DesignPattern
</a></li><li class="dropdown-item"><!----> <a href="/categories/Devops/" class="nav-link"><i class="undefined"></i>
  Devops
</a></li><li class="dropdown-item"><!----> <a href="/categories/Distributed/" class="nav-link"><i class="undefined"></i>
  Distributed
</a></li><li class="dropdown-item"><!----> <a href="/categories/Dubbo/" class="nav-link"><i class="undefined"></i>
  Dubbo
</a></li><li class="dropdown-item"><!----> <a href="/categories/Es/" class="nav-link"><i class="undefined"></i>
  Es
</a></li><li class="dropdown-item"><!----> <a href="/categories/Front/" class="nav-link"><i class="undefined"></i>
  Front
</a></li><li class="dropdown-item"><!----> <a href="/categories/Java/" class="nav-link"><i class="undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/categories/Linux/" class="nav-link"><i class="undefined"></i>
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/categories/MySQL/" class="nav-link"><i class="undefined"></i>
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/categories/MQ/" class="nav-link"><i class="undefined"></i>
  MQ
</a></li><li class="dropdown-item"><!----> <a href="/categories/Netty/" class="nav-link"><i class="undefined"></i>
  Netty
</a></li><li class="dropdown-item"><!----> <a href="/categories/Others/" class="nav-link"><i class="undefined"></i>
  Others
</a></li><li class="dropdown-item"><!----> <a href="/categories/Redis/" class="nav-link"><i class="undefined"></i>
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/categories/Spring/" class="nav-link"><i class="undefined"></i>
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/categories/Tools/" class="nav-link"><i class="undefined"></i>
  Tools
</a></li><li class="dropdown-item"><!----> <a href="/categories/Zookeeper/" class="nav-link"><i class="undefined"></i>
  Zookeeper
</a></li><li class="dropdown-item"><!----> <a href="/categories/WorkFlow/" class="nav-link"><i class="undefined"></i>
  WorkFlow
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Docs
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/theme-reco/" class="nav-link"><i class="undefined"></i>
  vuepress-reco
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/plantre" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>Redis</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>wzg</span>
          
        <span data-v-59e6cb88>2017 - </span>
        2024
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">Redis</h1> <div data-v-8a445198><i class="iconfont reco-account" data-v-8a445198><span data-v-8a445198>wzg</span></i> <i class="iconfont reco-date" data-v-8a445198><span data-v-8a445198>9/1/2022</span></i> <!----> <i class="tags iconfont reco-tag" data-v-8a445198><span class="tag-item" data-v-8a445198>Redis</span></i></div></div> <div class="theme-reco-content content__default"><h2 id="为什么那么快"><a href="#为什么那么快" class="header-anchor">#</a> 为什么那么快</h2> <h3 id="基于内存实现"><a href="#基于内存实现" class="header-anchor">#</a> 基于内存实现</h3> <h3 id="高效的数据结构"><a href="#高效的数据结构" class="header-anchor">#</a> 高效的数据结构</h3> <h3 id="丰富而合理的编码"><a href="#丰富而合理的编码" class="header-anchor">#</a> 丰富而合理的编码</h3> <h3 id="写时拷贝"><a href="#写时拷贝" class="header-anchor">#</a> 写时拷贝</h3> <p>（CopyOnWrite）</p> <p>内核只为新生成的子进程创建虚拟空间结构，它们来复制于父进程的虚拟空间结构，但是不为这些段分配物理内存</p> <h3 id="零拷贝技术"><a href="#零拷贝技术" class="header-anchor">#</a> 零拷贝技术</h3> <p>直接从 PageCache 中把数据复制到 Socket 缓冲区中，不用把数据复制到用户内存空间，DMA 控制器可以直接完成数据复制，不需要 CPU 参与，速度更快</p> <h3 id="客户端管道批量命令"><a href="#客户端管道批量命令" class="header-anchor">#</a> 客户端管道批量命令</h3> <h3 id="单线程"><a href="#单线程" class="header-anchor">#</a> 单线程</h3> <h3 id="合适的线程模型"><a href="#合适的线程模型" class="header-anchor">#</a> 合适的线程模型</h3> <p>I/O 多路复用</p> <h3 id="redis6-0后引入多线程提速"><a href="#redis6-0后引入多线程提速" class="header-anchor">#</a> Redis6.0后引入多线程提速</h3> <h2 id="数据结构"><a href="#数据结构" class="header-anchor">#</a> 数据结构</h2> <h3 id="string"><a href="#string" class="header-anchor">#</a> string</h3> <p>适用于简单key-value存储、setnx key value实现分布式锁、计数器(原子性)、分布式全局唯一ID</p> <p>底层：用char[]数组表示，源码中用SDS(simple dynamic string)封装char[]，这是是Redis存储的最小单元，一个SDS最大可以存储512M信息，</p> <p>Redis对SDS再次封装生成了RedisObject，type = REDIS_STRING,Redis会创建键的RedisObject 和 值的RedisOjbect</p> <p>自动存储int类型，非int类型用raw编码</p> <p><strong>OBJ_ENCODING_EMBSTR</strong></p> <p>Redis针对短字符串的优化</p> <p>内存申请和释放都只需要调用一次内存操作函数</p> <p>redisObject、sdshdr结构保存在一块连续的内存中，减少了内存碎片</p> <p><strong>OBJ_ENCODING_RAW</strong></p> <p>长度大于OBJ_ENCODING_EMBSTR_SIZE_LIMIT的字符串，在该编码中，redisObject、sds结构存放在两个不连续的内存块中</p> <p><strong>OBJ_ENCODING_INT</strong></p> <p>将数值型字符串转换为整型，可以大幅降低数据占用的内存空间</p> <h4 id="sds"><a href="#sds" class="header-anchor">#</a> sds</h4> <p>获取字符串长度复杂度为O(1),因为前期已经将字符串的长度写在len这个变量里面了</p> <p>SDS在修改的时候，Redis的API会主动将SDS的大小扩展到执行修改所需要的大小，然后才执行实际的修改操作</p> <p>C 字符串 只能保存文本数据,比如“\0”</p> <p>通过空间预分配和惰性空间释放两种方法，搭配len和free两个变量，来实现对内存分配策略的优化,减少修改字符串时带来的内存重分配次数</p> <p>1.C字符串中，更改字符串长度，内存就会重新分配，而SDS不需要每次都进行重新分配</p> <p>2.空间预分配,当SDS的API对一个SDS进行修改，并且需要对SDS进行空间扩展的时候，程序不仅会为SDS分配修改所必须要的空间，还会为SDS分配额外的未使用空间</p> <p>小于1MB，*2</p> <p>于等于1MB,=1m</p> <h3 id="list"><a href="#list" class="header-anchor">#</a> list</h3> <p>lpush + lpop = stack 先进后出的栈</p> <p>lpush + rpop = queue 先进先出的队列</p> <p>lpush + ltrim = capped collection 有限集合</p> <p>lpush + brpop = message queue 消息队列</p> <p>字符串长度且元素个数小于一定范围使用 ziplist 编码，否则转化为 linkedlist 编码</p> <h3 id="hash"><a href="#hash" class="header-anchor">#</a> hash</h3> <h4 id="渐进式rehash"><a href="#渐进式rehash" class="header-anchor">#</a> 渐进式rehash</h4> <p>rehashidx != -1则表示扩容到数组中的第几个了</p> <p><strong>load_factor = ht[0].used / ht[0].size</strong></p> <h6 id="_0-1收缩"><a href="#_0-1收缩" class="header-anchor">#</a> &lt;0.1收缩</h6> <h6 id="_1"><a href="#_1" class="header-anchor">#</a> &gt;=1</h6> <h6 id="_5"><a href="#_5" class="header-anchor">#</a> &gt;=5</h6> <p>服务器目前正在执行BGSAVE命令或者BGREWRITEAOF命令</p> <p>K是字符串，V是多种</p> <h3 id="set"><a href="#set" class="header-anchor">#</a> set</h3> <p>保存元素为整数及元素个数小于一定范围使用 intset 编码，任意条件不满足，则使用 hashtable 编码</p> <h3 id="zset"><a href="#zset" class="header-anchor">#</a> zset</h3> <p>底层：跳表，查找数据时，是从上往下，从左往右进行查找。</p> <p>保存的元素个数小于定值且成员长度小于定值使用 ziplist 编码，任意条件不满足，则使用 skiplist 编码</p> <h6 id="应用"><a href="#应用" class="header-anchor">#</a> 应用</h6> <p>积分排行榜</p> <p>时间排序新闻</p> <p>延时队列</p> <h3 id="redis-geo"><a href="#redis-geo" class="header-anchor">#</a> Redis Geo</h3> <p>GEO利用 GeoHash 将二维的经纬度转换成字符串，来实现位置的划分跟指定距离的查询</p> <h3 id="hyperloglog"><a href="#hyperloglog" class="header-anchor">#</a> HyperLogLog</h3> <h3 id="bitmap"><a href="#bitmap" class="header-anchor">#</a> bitmap</h3> <h6 id="应用-2"><a href="#应用-2" class="header-anchor">#</a> 应用</h6> <p>用户签到</p> <p>统计活跃用户</p> <h3 id="bloom-filter"><a href="#bloom-filter" class="header-anchor">#</a> Bloom Filter</h3> <p>不存在的一定不存在，存在的不一定存在</p> <h2 id="持久化"><a href="#持久化" class="header-anchor">#</a> 持久化</h2> <h3 id="快照-rdb"><a href="#快照-rdb" class="header-anchor">#</a> 快照-RDB</h3> <p>（snapshotting）</p> <h3 id="只追加文件-aof"><a href="#只追加文件-aof" class="header-anchor">#</a> 只追加文件-AOF</h3> <p>（append-only file）</p> <h2 id="高可用"><a href="#高可用" class="header-anchor">#</a> 高可用</h2> <h3 id="单机"><a href="#单机" class="header-anchor">#</a> 单机</h3> <p>架构简单，部署方便</p> <p>机器故障、容量瓶颈、QPS瓶颈</p> <h3 id="主从复制-6379"><a href="#主从复制-6379" class="header-anchor">#</a> 主从复制（6379）</h3> <p>高可靠性，读写分离</p> <p>故障恢复复杂，主库的写跟存受单机限制</p> <h4 id="一主一从"><a href="#一主一从" class="header-anchor">#</a> 一主一从</h4> <p>slaveof/slaveof no one</p> <p>从节点只读	slave-read-only = yes</p> <p>网络延迟	repl-disable-tcp-nodelay no	当开启时，主节点会合并较小的 TCP 数据包从而节省带宽</p> <h4 id="一主多从"><a href="#一主多从" class="header-anchor">#</a> 一主多从</h4> <p>replicaof/info replication</p> <h4 id="树状主从结构"><a href="#树状主从结构" class="header-anchor">#</a> 树状主从结构</h4> <h3 id="哨兵模式"><a href="#哨兵模式" class="header-anchor">#</a> 哨兵模式</h3> <p>-Redis Sentinel （26379）</p> <p><strong>优点：</strong></p> <p>集群部署简单，HA</p> <p><strong>缺点：</strong></p> <p>原理繁琐，slave存在资源浪费，不能解决读写分离问题</p> <p>当主节点出现故障时，Redis Sentinel 能自动完成故障发现和故障转移，并通知应用方，从而实现真正的高可用</p> <p>redis-server sentinel.conf --sentinel</p> <p>监控</p> <p>通知</p> <p>主节点故障转移</p> <p>配置提供者</p> <h4 id="脑裂问题"><a href="#脑裂问题" class="header-anchor">#</a> 脑裂问题</h4> <p>因为网络原因，导致master节点、slave节点 和 sentinel集群处于不用的网络分区，因为sentinel集群无法感知到master的存在，所以将slave节点提升为master节点</p> <h2 id="高并发"><a href="#高并发" class="header-anchor">#</a> 高并发</h2> <h3 id="集群"><a href="#集群" class="header-anchor">#</a> 集群</h3> <p>数据动态存储solt，可扩展，高可用</p> <p>客户端动态感知后端变更，批量操作支持查</p> <p><code>redis-cli --cluster create 192.168.153.128:6379 192.168.153.131:6379 192.168.153.132:6379</code></p> <p><code>redis-cli --cluster add-node 192.168.153.129:6379 192.168.153.128:6379 --cluster-slave --cluster-master-id a7e948208badf171d19dbfe2d444ea7295bdbf60</code></p> <p><code>redis-cli --cluster check 192.168.153.128:6379 --cluster-search-multiple-owners</code></p> <p><code>redis-cli --cluster info 192.168.153.128:6379</code></p> <p><strong>为什么RedisCluster设计成16384个槽</strong></p> <p>如果槽位为65536，发送心跳信息的消息头达8k，发送的心跳包过于庞大。
如上所述，在消息头中，最占空间的是myslots[CLUSTER_SLOTS/8]。
当槽位为65536时，这块的大小是:
65536÷8÷1024=8kb</p> <p>redis的集群主节点数量基本不可能超过1000个</p> <p>槽位越小，节点少的情况下，压缩率高</p> <h2 id="常见问题"><a href="#常见问题" class="header-anchor">#</a> 常见问题</h2> <h3 id="缓存雪崩"><a href="#缓存雪崩" class="header-anchor">#</a> 缓存雪崩</h3> <p>Redis中大批量key在同一时间同时失效导致所有请求都打到了MySQL</p> <h5 id="解决"><a href="#解决" class="header-anchor">#</a> 解决</h5> <p>缓存数据的过期时间加上个随机值</p> <p>如果缓存数据库是分布式部署，将热点数据均匀分布在不同得缓存数据库中</p> <p>设置热点数据永远不过期</p> <h3 id="缓存穿透"><a href="#缓存穿透" class="header-anchor">#</a> 缓存穿透</h3> <p>指缓存和数据库中都没有的数据</p> <h5 id="解决-2"><a href="#解决-2" class="header-anchor">#</a> 解决</h5> <p>后端接口层增加 用户鉴权校验，参数做校验等</p> <p>单个IP每秒访问次数超过阈值直接拉黑IP</p> <p>从缓存取不到的数据，在数据库中也没有取到，这时也可以将key-value对写为key-null 失效时间可以为15秒防止恶意攻击</p> <p>用Redis提供的  Bloom Filter 特性也OK</p> <h3 id="缓存击穿"><a href="#缓存击穿" class="header-anchor">#</a> 缓存击穿</h3> <p>大并发集中对这一个热点key进行访问，当这个Key在失效的瞬间，持续的大并发就穿破缓存，直接请求数据库</p> <h5 id="解决-3"><a href="#解决-3" class="header-anchor">#</a> 解决</h5> <p>设置热点数据永远不过期</p> <p>加上互斥锁</p> <h3 id="双写一致性"><a href="#双写一致性" class="header-anchor">#</a> 双写一致性</h3> <p>先更新数据库，再更新缓存</p> <p>先删缓存，再更新数据库</p> <h6 id="cache-aside-pattern"><a href="#cache-aside-pattern" class="header-anchor">#</a> Cache Aside Pattern</h6> <p>更新 DB，然后直接删除 cache</p> <h3 id="事务"><a href="#事务" class="header-anchor">#</a> 事务</h3> <h3 id="过期策略和内存淘汰策略"><a href="#过期策略和内存淘汰策略" class="header-anchor">#</a> 过期策略和内存淘汰策略</h3> <h4 id="过期策略"><a href="#过期策略" class="header-anchor">#</a> 过期策略</h4> <p>定时过期</p> <p>惰性过期</p> <p>定期过期</p> <h4 id="内存淘汰策略"><a href="#内存淘汰策略" class="header-anchor">#</a> 内存淘汰策略</h4> <p>在Redis的用于缓存的内存不足时，怎么处理需要新写入且需要申请额外空间的数据</p> <p>1）全局的键空间选择性移除</p> <p>​	<strong>allkeys-lru</strong>：在键空间中，移除最近最少使用的key。（这个是最常用的）</p> <p>​	<strong>allkeys-random</strong>：在键空间中，随机移除某个key。</p> <p>​	<strong>no-eviction</strong>：当内存不足以容纳新写入数据时，新写入操作会报错。</p> <p>2）设置过期时间的键空间选择性移除</p> <p>​	<strong>volatile-lru</strong>：在设置了过期时间的键空间中，移除最近最少使用的key。</p> <p>​	<strong>volatile-random</strong>：在设置了过期时间的键空间中，随机移除某个key。</p> <p>​	<strong>volatile-ttl</strong>：在设置了过期时间的键空间中，有更早过期时间的key优先移除。</p> <p><strong>总结</strong></p> <p>Redis的内存淘汰策略的选取并不会影响过期的key的处理。</p> <p>内存淘汰策略用于处理内存不足时的需要申请额外空间的数据；</p> <p>过期策略用于处理过期的缓存数据。</p> <h3 id="消息通知"><a href="#消息通知" class="header-anchor">#</a> 消息通知</h3> <h3 id="管道"><a href="#管道" class="header-anchor">#</a> 管道</h3></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">4/15/2023, 1:36:11 AM</span></div></footer> <!----> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-b57cc07c data-v-7dd95ae2><li class="level-2" data-v-b57cc07c><a href="/blogs/Redis/2022/090101.html#为什么那么快" class="sidebar-link reco-side-为什么那么快" data-v-b57cc07c>为什么那么快</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/Redis/2022/090101.html#基于内存实现" class="sidebar-link reco-side-基于内存实现" data-v-b57cc07c>基于内存实现</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/Redis/2022/090101.html#高效的数据结构" class="sidebar-link reco-side-高效的数据结构" data-v-b57cc07c>高效的数据结构</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/Redis/2022/090101.html#丰富而合理的编码" class="sidebar-link reco-side-丰富而合理的编码" data-v-b57cc07c>丰富而合理的编码</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/Redis/2022/090101.html#写时拷贝" class="sidebar-link reco-side-写时拷贝" data-v-b57cc07c>写时拷贝</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/Redis/2022/090101.html#零拷贝技术" class="sidebar-link reco-side-零拷贝技术" data-v-b57cc07c>零拷贝技术</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/Redis/2022/090101.html#客户端管道批量命令" class="sidebar-link reco-side-客户端管道批量命令" data-v-b57cc07c>客户端管道批量命令</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/Redis/2022/090101.html#单线程" class="sidebar-link reco-side-单线程" data-v-b57cc07c>单线程</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/Redis/2022/090101.html#合适的线程模型" class="sidebar-link reco-side-合适的线程模型" data-v-b57cc07c>合适的线程模型</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/Redis/2022/090101.html#redis6-0后引入多线程提速" class="sidebar-link reco-side-redis6-0后引入多线程提速" data-v-b57cc07c>Redis6.0后引入多线程提速</a></li><li class="level-2" data-v-b57cc07c><a href="/blogs/Redis/2022/090101.html#数据结构" class="sidebar-link reco-side-数据结构" data-v-b57cc07c>数据结构</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/Redis/2022/090101.html#string" class="sidebar-link reco-side-string" data-v-b57cc07c>string</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/Redis/2022/090101.html#list" class="sidebar-link reco-side-list" data-v-b57cc07c>list</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/Redis/2022/090101.html#hash" class="sidebar-link reco-side-hash" data-v-b57cc07c>hash</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/Redis/2022/090101.html#set" class="sidebar-link reco-side-set" data-v-b57cc07c>set</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/Redis/2022/090101.html#zset" class="sidebar-link reco-side-zset" data-v-b57cc07c>zset</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/Redis/2022/090101.html#redis-geo" class="sidebar-link reco-side-redis-geo" data-v-b57cc07c>Redis Geo</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/Redis/2022/090101.html#hyperloglog" class="sidebar-link reco-side-hyperloglog" data-v-b57cc07c>HyperLogLog</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/Redis/2022/090101.html#bitmap" class="sidebar-link reco-side-bitmap" data-v-b57cc07c>bitmap</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/Redis/2022/090101.html#bloom-filter" class="sidebar-link reco-side-bloom-filter" data-v-b57cc07c>Bloom Filter</a></li><li class="level-2" data-v-b57cc07c><a href="/blogs/Redis/2022/090101.html#持久化" class="sidebar-link reco-side-持久化" data-v-b57cc07c>持久化</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/Redis/2022/090101.html#快照-rdb" class="sidebar-link reco-side-快照-rdb" data-v-b57cc07c>快照-RDB</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/Redis/2022/090101.html#只追加文件-aof" class="sidebar-link reco-side-只追加文件-aof" data-v-b57cc07c>只追加文件-AOF</a></li><li class="level-2" data-v-b57cc07c><a href="/blogs/Redis/2022/090101.html#高可用" class="sidebar-link reco-side-高可用" data-v-b57cc07c>高可用</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/Redis/2022/090101.html#单机" class="sidebar-link reco-side-单机" data-v-b57cc07c>单机</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/Redis/2022/090101.html#主从复制-6379" class="sidebar-link reco-side-主从复制-6379" data-v-b57cc07c>主从复制（6379）</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/Redis/2022/090101.html#哨兵模式" class="sidebar-link reco-side-哨兵模式" data-v-b57cc07c>哨兵模式</a></li><li class="level-2" data-v-b57cc07c><a href="/blogs/Redis/2022/090101.html#高并发" class="sidebar-link reco-side-高并发" data-v-b57cc07c>高并发</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/Redis/2022/090101.html#集群" class="sidebar-link reco-side-集群" data-v-b57cc07c>集群</a></li><li class="level-2" data-v-b57cc07c><a href="/blogs/Redis/2022/090101.html#常见问题" class="sidebar-link reco-side-常见问题" data-v-b57cc07c>常见问题</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/Redis/2022/090101.html#缓存雪崩" class="sidebar-link reco-side-缓存雪崩" data-v-b57cc07c>缓存雪崩</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/Redis/2022/090101.html#缓存穿透" class="sidebar-link reco-side-缓存穿透" data-v-b57cc07c>缓存穿透</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/Redis/2022/090101.html#缓存击穿" class="sidebar-link reco-side-缓存击穿" data-v-b57cc07c>缓存击穿</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/Redis/2022/090101.html#双写一致性" class="sidebar-link reco-side-双写一致性" data-v-b57cc07c>双写一致性</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/Redis/2022/090101.html#事务" class="sidebar-link reco-side-事务" data-v-b57cc07c>事务</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/Redis/2022/090101.html#过期策略和内存淘汰策略" class="sidebar-link reco-side-过期策略和内存淘汰策略" data-v-b57cc07c>过期策略和内存淘汰策略</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/Redis/2022/090101.html#消息通知" class="sidebar-link reco-side-消息通知" data-v-b57cc07c>消息通知</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/Redis/2022/090101.html#管道" class="sidebar-link reco-side-管道" data-v-b57cc07c>管道</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><canvas id="vuepress-canvas-cursor"></canvas><canvas id="vuepress-canvas-ribbon"></canvas></div></div>
    <script src="/assets/js/app.05e9a5df.js" defer></script><script src="/assets/js/3.c925c384.js" defer></script><script src="/assets/js/1.9975a5e7.js" defer></script><script src="/assets/js/47.ab37bc5f.js" defer></script>
  </body>
</html>
